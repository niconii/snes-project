                ;; SNES memory map setting
snes_mapper     := "lorom"

lorom           .segment
                snes_mapper := "lorom"
                .endsegment

hirom           .segment
                snes_mapper := "hirom"
                .endsegment

org             .macro addr
                .if snes_mapper == "lorom"
                    rom_addr = (\addr & $7f0000) >> 1 | \addr & $007fff
                .elsif snes_mapper == "hirom"
                    rom_addr = \addr & $3fffff
                .endif
                * = \addr
                .offs rom_addr - *
                .endmacro

                ;; Other macros
dma_to_vram     .macro chan, src, len, dst
                .if \dst == $0000
                stz VMADDL
                .else
                mva #\dst, VMADDL
                .endif
                mvy #%00000001,  DMAP0 + $10*\chan
                mvy #<VMDATAL,   BBAD0 + $10*\chan
                mva #<>\src,     A1T0L + $10*\chan
                mvy #`\src,      A1B0  + $10*\chan
                mva #\len,       DAS0L + $10*\chan
                mvy #1 << \chan, MDMAEN
                .endmacro

                ;; RGB functions
rgb             .sfunction r, g, b, (b << 10 | g << 5 | r)
rgb24           .sfunction r, g, b, rgb(r >> 3, g >> 3, b >> 3)

                ;; MMIO registers
INIDISP         = $802100
OBSEL           = $802101
OAMADDL         = $802102
OAMADDH         = $802103
OAMDATA         = $802104
BGMODE          = $802105
MOSAIC          = $802106
BG1SC           = $802107
BG2SC           = $802108
BG3SC           = $802109
BG4SC           = $80210A
BG12NBA         = $80210B
BG34NBA         = $80210C
BG1HOFS         = $80210D
BG1VOFS         = $80210E
BG2HOFS         = $80210F
BG2VOFS         = $802110
BG3HOFS         = $802111
BG3VOFS         = $802112
BG4HOFS         = $802113
BG4VOFS         = $802114
VMAIN           = $802115
VMADDL          = $802116
VMADDH          = $802117
VMDATAL         = $802118
VMDATAH         = $802119
M7SEL           = $80211A
M7A             = $80211B
M7B             = $80211C
M7C             = $80211D
M7D             = $80211E
M7X             = $80211F
M7Y             = $802120
CGADD           = $802121
CGDATA          = $802122
W12SEL          = $802123
W34SEL          = $802124
WOBJSEL         = $802125
WH0             = $802126
WH1             = $802127
WH2             = $802128
WH3             = $802129
WBGLOG          = $80212A
WOBJLOG         = $80212B
TM              = $80212C
TS              = $80212D
TMW             = $80212E
TSW             = $80212F
CGWSEL          = $802130
CGADSUB         = $802131
COLDATA         = $802132
SETINI          = $802133
MPYL            = $802134
MPYM            = $802135
MPYH            = $802136
SLHV            = $802137
RDOAM           = $802138
RDVRAML         = $802139
RDVRAMH         = $80213A
RDCGRAM         = $80213B
OPHCT           = $80213C
OPVCT           = $80213D
STAT77          = $80213E
STAT78          = $80213F
APUI00          = $802140
APUI01          = $802141
APUI02          = $802142
APUI03          = $802143
WMDATA          = $802180
WMADDL          = $802181
WMADDM          = $802182
WMADDH          = $802183
JOYWR           = $804016
JOYA            = $804016
JOYB            = $804017
NMITIMEN        = $804200
WRIO            = $804201
WRMPYA          = $804202
WRMPYB          = $804203
WRDIVL          = $804204
WRDIVH          = $804205
WRDIVB          = $804206
HTIMEL          = $804207
HTIMEH          = $804208
VTIMEL          = $804209
VTIMEH          = $80420A
MDMAEN          = $80420B
HDMAEN          = $80420C
MEMSEL          = $80420D
RDNMI           = $804210
TIMEUP          = $804211
HVBJOY          = $804212
RDIO            = $804213
RDDIVL          = $804214
RDDIVH          = $804215
RDMPYL          = $804216
RDMPYH          = $804217
JOY1L           = $804218
JOY1H           = $804219
JOY2L           = $80421A
JOY2H           = $80421B
JOY3L           = $80421C
JOY3H           = $80421D
JOY4L           = $80421E
JOY4H           = $80421F
DMAP0           = $804300
BBAD0           = $804301
A1T0L           = $804302
A1T0H           = $804303
A1B0            = $804304
DAS0L           = $804305
DAS0H           = $804306
DASB0           = $804307
A2A0L           = $804308
A2A0H           = $804309
NTRL0           = $80430A
UNUSED0         = $80430B
DMAP1           = $804310
BBAD1           = $804311
A1T1L           = $804312
A1T1H           = $804313
A1B1            = $804314
DAS1L           = $804315
DAS1H           = $804316
DASB1           = $804317
A2A1L           = $804318
A2A1H           = $804319
NTRL1           = $80431A
UNUSED1         = $80431B
DMAP2           = $804320
BBAD2           = $804321
A1T2L           = $804322
A1T2H           = $804323
A1B2            = $804324
DAS2L           = $804325
DAS2H           = $804326
DASB2           = $804327
A2A2L           = $804328
A2A2H           = $804329
NTRL2           = $80432A
UNUSED2         = $80432B
DMAP3           = $804330
BBAD3           = $804331
A1T3L           = $804332
A1T3H           = $804333
A1B3            = $804334
DAS3L           = $804335
DAS3H           = $804336
DASB3           = $804337
A2A3L           = $804338
A2A3H           = $804339
NTRL3           = $80433A
UNUSED3         = $80433B
DMAP4           = $804340
BBAD4           = $804341
A1T4L           = $804342
A1T4H           = $804343
A1B4            = $804344
DAS4L           = $804345
DAS4H           = $804346
DASB4           = $804347
A2A4L           = $804348
A2A4H           = $804349
NTRL4           = $80434A
UNUSED4         = $80434B
DMAP5           = $804350
BBAD5           = $804351
A1T5L           = $804352
A1T5H           = $804353
A1B5            = $804354
DAS5L           = $804355
DAS5H           = $804356
DASB5           = $804357
A2A5L           = $804358
A2A5H           = $804359
NTRL5           = $80435A
UNUSED5         = $80435B
DMAP6           = $804360
BBAD6           = $804361
A1T6L           = $804362
A1T6H           = $804363
A1B6            = $804364
DAS6L           = $804365
DAS6H           = $804366
DASB6           = $804367
A2A6L           = $804368
A2A6H           = $804369
NTRL6           = $80436A
UNUSED6         = $80436B
DMAP7           = $804370
BBAD7           = $804371
A1T7L           = $804372
A1T7H           = $804373
A1B7            = $804374
DAS7L           = $804375
DAS7H           = $804376
DASB7           = $804377
A2A7L           = $804378
A2A7H           = $804379
NTRL7           = $80437A
UNUSED7         = $80437B

                ;; MMIO registers (bank 0)
zINIDISP        = $002100
zOBSEL          = $002101
zOAMADDL        = $002102
zOAMADDH        = $002103
zOAMDATA        = $002104
zBGMODE         = $002105
zMOSAIC         = $002106
zBG1SC          = $002107
zBG2SC          = $002108
zBG3SC          = $002109
zBG4SC          = $00210A
zBG12NBA        = $00210B
zBG34NBA        = $00210C
zBG1HOFS        = $00210D
zBG1VOFS        = $00210E
zBG2HOFS        = $00210F
zBG2VOFS        = $002110
zBG3HOFS        = $002111
zBG3VOFS        = $002112
zBG4HOFS        = $002113
zBG4VOFS        = $002114
zVMAIN          = $002115
zVMADDL         = $002116
zVMADDH         = $002117
zVMDATAL        = $002118
zVMDATAH        = $002119
zM7SEL          = $00211A
zM7A            = $00211B
zM7B            = $00211C
zM7C            = $00211D
zM7D            = $00211E
zM7X            = $00211F
zM7Y            = $002120
zCGADD          = $002121
zCGDATA         = $002122
zW12SEL         = $002123
zW34SEL         = $002124
zWOBJSEL        = $002125
zWH0            = $002126
zWH1            = $002127
zWH2            = $002128
zWH3            = $002129
zWBGLOG         = $00212A
zWOBJLOG        = $00212B
zTM             = $00212C
zTS             = $00212D
zTMW            = $00212E
zTSW            = $00212F
zCGWSEL         = $002130
zCGADSUB        = $002131
zCOLDATA        = $002132
zSETINI         = $002133
zMPYL           = $002134
zMPYM           = $002135
zMPYH           = $002136
zSLHV           = $002137
zRDOAM          = $002138
zRDVRAML        = $002139
zRDVRAMH        = $00213A
zRDCGRAM        = $00213B
zOPHCT          = $00213C
zOPVCT          = $00213D
zSTAT77         = $00213E
zSTAT78         = $00213F
zAPUI00         = $002140
zAPUI01         = $002141
zAPUI02         = $002142
zAPUI03         = $002143
zWMDATA         = $002180
zWMADDL         = $002181
zWMADDM         = $002182
zWMADDH         = $002183
zJOYWR          = $004016
zJOYA           = $004016
zJOYB           = $004017
zNMITIMEN       = $004200
zWRIO           = $004201
zWRMPYA         = $004202
zWRMPYB         = $004203
zWRDIVL         = $004204
zWRDIVH         = $004205
zWRDIVB         = $004206
zHTIMEL         = $004207
zHTIMEH         = $004208
zVTIMEL         = $004209
zVTIMEH         = $00420A
zMDMAEN         = $00420B
zHDMAEN         = $00420C
zMEMSEL         = $00420D
zRDNMI          = $004210
zTIMEUP         = $004211
zHVBJOY         = $004212
zRDIO           = $004213
zRDDIVL         = $004214
zRDDIVH         = $004215
zRDMPYL         = $004216
zRDMPYH         = $004217
zJOY1L          = $004218
zJOY1H          = $004219
zJOY2L          = $00421A
zJOY2H          = $00421B
zJOY3L          = $00421C
zJOY3H          = $00421D
zJOY4L          = $00421E
zJOY4H          = $00421F
zDMAP0          = $004300
zBBAD0          = $004301
zA1T0L          = $004302
zA1T0H          = $004303
zA1B0           = $004304
zDAS0L          = $004305
zDAS0H          = $004306
zDASB0          = $004307
zA2A0L          = $004308
zA2A0H          = $004309
zNTRL0          = $00430A
zUNUSED0        = $00430B
zDMAP1          = $004310
zBBAD1          = $004311
zA1T1L          = $004312
zA1T1H          = $004313
zA1B1           = $004314
zDAS1L          = $004315
zDAS1H          = $004316
zDASB1          = $004317
zA2A1L          = $004318
zA2A1H          = $004319
zNTRL1          = $00431A
zUNUSED1        = $00431B
zDMAP2          = $004320
zBBAD2          = $004321
zA1T2L          = $004322
zA1T2H          = $004323
zA1B2           = $004324
zDAS2L          = $004325
zDAS2H          = $004326
zDASB2          = $004327
zA2A2L          = $004328
zA2A2H          = $004329
zNTRL2          = $00432A
zUNUSED2        = $00432B
zDMAP3          = $004330
zBBAD3          = $004331
zA1T3L          = $004332
zA1T3H          = $004333
zA1B3           = $004334
zDAS3L          = $004335
zDAS3H          = $004336
zDASB3          = $004337
zA2A3L          = $004338
zA2A3H          = $004339
zNTRL3          = $00433A
zUNUSED3        = $00433B
zDMAP4          = $004340
zBBAD4          = $004341
zA1T4L          = $004342
zA1T4H          = $004343
zA1B4           = $004344
zDAS4L          = $004345
zDAS4H          = $004346
zDASB4          = $004347
zA2A4L          = $004348
zA2A4H          = $004349
zNTRL4          = $00434A
zUNUSED4        = $00434B
zDMAP5          = $004350
zBBAD5          = $004351
zA1T5L          = $004352
zA1T5H          = $004353
zA1B5           = $004354
zDAS5L          = $004355
zDAS5H          = $004356
zDASB5          = $004357
zA2A5L          = $004358
zA2A5H          = $004359
zNTRL5          = $00435A
zUNUSED5        = $00435B
zDMAP6          = $004360
zBBAD6          = $004361
zA1T6L          = $004362
zA1T6H          = $004363
zA1B6           = $004364
zDAS6L          = $004365
zDAS6H          = $004366
zDASB6          = $004367
zA2A6L          = $004368
zA2A6H          = $004369
zNTRL6          = $00436A
zUNUSED6        = $00436B
zDMAP7          = $004370
zBBAD7          = $004371
zA1T7L          = $004372
zA1T7H          = $004373
zA1B7           = $004374
zDAS7L          = $004375
zDAS7H          = $004376
zDASB7          = $004377
zA2A7L          = $004378
zA2A7H          = $004379
zNTRL7          = $00437A
zUNUSED7        = $00437B
